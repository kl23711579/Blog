<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="A new Hugo site."><title>1/9 é–’èŠ - o1vv1rnna</title><link rel="shortcut icon" href=/blog/gura.ico><link rel=stylesheet href=/blog/css/main.min.c5514d3530979d291f3497facc20da1cec870028dbc2a3630b64bab8721bbe49.css integrity="sha256-xVFNNTCXnSkfNJf6zCDaHOyHACjbwqNjC2S6uHIbvkk=" crossorigin=anonymous media=screen><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Didact+Gothic"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kl23711579.github.io/blog/tn.png"><meta name=twitter:title content="1/9 é–’èŠ"><meta name=twitter:description content="DebugXPythonXCrawler&nbsp;Â¶"><meta property="og:title" content="1/9 é–’èŠ"><meta property="og:description" content="DebugXPythonXCrawler&nbsp;Â¶"><meta property="og:type" content="article"><meta property="og:url" content="https://kl23711579.github.io/blog/posts/20200109/"><meta property="og:image" content="https://kl23711579.github.io/blog/tn.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-01-10T00:24:54+10:00"><meta property="article:modified_time" content="2020-01-10T00:24:54+10:00"><meta property="og:site_name" content="o1vv1rnna"><title>1/9 é–’èŠ</title></head><body><header class="wrap flex-container"><h1>1/9 é–’èŠ</h1></header><main class=wrap><div class=flex-container><aside role=complementary>Fri Jan 10, 2020 &#183; 505 words<div class=tag-container><span class=tag><a href=/blog/tags/hugo/>Hugo</a></span>
<span class=tag><a href=/blog/tags/python/>Python</a></span>
<span class=tag><a href=/blog/tags/scrapy/>scrapy</a></span>
<span class=tag><a href=/blog/tags/pip/>pip</a></span></div></aside><hr><article role=article><h1 id=debugxpythonxcrawler class=anchor-link><a href=#debugxpythonxcrawler>DebugXPythonXCrawler<span class=pilcrow>&nbsp;Â¶</span></a></h1><p>å…ˆä¾†é¦–æ­Œå§ï¼Œæ›¾ç¶“è”šè—ï¼Œå°ç£é™å®š ğŸ’œğŸ’™</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/TRTquokWSCw style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><h1 id=debug class=anchor-link><a href=#debug>Debug<span class=pilcrow>&nbsp;Â¶</span></a></h1><p>æ˜¨å¤©å·®é» debug åˆ°å´©æ½°ï¼Œå®Œå…¨ä¸çŸ¥é“å‡ºäº†ä»€éº¼éŒ¯èª¤</p><p>å› ç‚º bug ç„¡æ³•é‡ç¾ï¼Œæ‰€ä»¥ä¹‹å¾Œå‡ºç¾å†è£œåœ–å§</p><p>æ±ç¿»è¥¿æ‰¾ï¼ŒåŸæœ¬ä»¥ç‚ºæ˜¯ theme çš„ layout æœ‰å•é¡Œ</p><p>æäº†åŠå¤©çµæœä¸æ˜¯ QQ</p><h2 id=bug class=anchor-link><a href=#bug>bug<span class=pilcrow>&nbsp;Â¶</span></a></h2><blockquote><p>Mixed content error</p></blockquote><p>æœ€å´©æ½°çš„æ˜¯ï¼Œé–‹ç™¼è€…æ¨¡å¼å®Œå…¨ç„¡æ³•æ‰¾åˆ° bug æ˜¯æ€éº¼ç™¼ç”Ÿçš„</p><p>å‡ºç¾çš„ä½ç½®æ˜¯ <code>(index):1 error</code> ä¹Ÿå°±æ˜¯ <code>&lt;!DOCTYPE html></code></p><p>å®Œå…¨å•è™Ÿï¼Œä¸çŸ¥é“æ€éº¼è™•ç† T T</p><h2 id=solution class=anchor-link><a href=#solution>Solution<span class=pilcrow>&nbsp;Â¶</span></a></h2><p>å¾Œä¾†æ‰¾åˆ°çš„ç­”æ¡ˆæ˜¯æŠŠ baseURL æ”¹æ‰</p><p>å¾ <code>baseURL= 'https://kl23711579.github.io/blog'</code> è®Šæˆ <code>baseURL= '/blog'</code></p><p>é€™æ¨£å°±å¯ä»¥äº†</p><p>ç†ç”±å‘¢ï¼Œå®Œå…¨ä¸çŸ¥é“ï¼ŒçœŸçœŸæ­£æ­£çš„æŠ€è¡“å‚µå•Šï½</p><p>Source: <a href=https://discourse.gohugo.io/t/theme-breaks-with-https-solved-by-baseurl-example-com/16427>Theme breaks with https? [SOLVED by baseURL = //example.com]</a></p><h1 id=python-and-pip class=anchor-link><a href=#python-and-pip>Python and pip<span class=pilcrow>&nbsp;Â¶</span></a></h1><p>ä»Šå¤©å› ç‚ºè¦å¯«å€‹çˆ¬èŸ²(æ•´å¤©æœ‰äº‹æ²’äº‹éƒ½åœ¨å¯«çˆ¬èŸ²)ï¼Œæƒ³èªªé †ä¾¿è¦ç·´ç¿’ python</p><p>æ‰€ä»¥é¸æ“‡äº† scrapyï¼Œä¸€å®‰è£ä¸‹å»å°±æ˜¯æ‚²åŠ‡çš„é–‹å§‹å•Š</p><p>å› ç‚º dependence å¤ªå¤šäº†ï¼Œæ‰€ä»¥ pip è®Šå¾—å¾ˆé›£ç®¡ç†</p><p>å†åŠ ä¸Š pip æ²’è¨­å®šå¥½ï¼Œé‚„æ˜¯ç¹¼çºŒç”¨ python2ï¼Œä¹Ÿè¦é‡æ–°è¨­å®š</p><p>æ‰€ä»¥èŠ±äº†å¾ˆé•·ä¸€æ®µæ™‚é–“é‡æ–°è¨­å®š python</p><h2 id=setup-python-and-pip class=anchor-link><a href=#setup-python-and-pip>Setup python and pip<span class=pilcrow>&nbsp;Â¶</span></a></h2><p>é¦–å…ˆè¦å…ˆç¢ºå®š terminal æ˜¯ç”¨ä»€éº¼ shellï¼Œæˆ‘çš„æ˜¯ zshï¼Œæ‰€ä»¥è¦æ›´æ”¹ <code>.zshrc</code> é€™å€‹æª”æ¡ˆ</p><p>åŠ ä¸Šé€™å…©è¡Œ</p><pre><code>alias python='python3'
alias pip='pip3'
</code></pre><p>In this situation, if we input <code>python</code> in terminal, it will execute <code>python3</code>.</p><p>And if we input <code>pip</code> in terminal, it will execute <code>pip3</code>.</p><p>ç„¶å¾Œ python å»ºè­°ç”¨ homebrew ç®¡ç†</p><p>Source: <a href=https://opensource.com/article/19/5/python-3-default-mac>The right and wrong way to set Python 3 as default on a Mac</a></p><h2 id=virtual-environment class=anchor-link><a href=#virtual-environment>Virtual environment<span class=pilcrow>&nbsp;Â¶</span></a></h2><p>In order to manage the dependence of the module, I deceide to adopt <code>virtualenv</code>.</p><p>This tool can create an isolated Python environment, so you can manage dependence in this environment.</p><h3 id=install class=anchor-link><a href=#install>Install<span class=pilcrow>&nbsp;Â¶</span></a></h3><p><code>pip install --user virtualenv</code></p><blockquote><p>It is discourage to use <code>sudo</code> to install module.</p></blockquote><h3 id=usage class=anchor-link><a href=#usage>Usage<span class=pilcrow>&nbsp;Â¶</span></a></h3><ul><li><h4 id=create class=anchor-link><a href=#create>Create<span class=pilcrow>&nbsp;Â¶</span></a></h4></li></ul><p><code>virtualenv temp</code></p><p>It will create a directory <code>temp</code></p><ul><li><h4 id=start-virtual-envuronment class=anchor-link><a href=#start-virtual-envuronment>Start virtual envuronment<span class=pilcrow>&nbsp;Â¶</span></a></h4></li></ul><p><code>source temp/bin/activate</code></p><p>This will change your <code>$PATH</code> so its first entry is the virtualenvâ€™s <code>bin/</code> directory. (You have to use source because it changes your shell environment in-place.)</p><p>Now, when you install any module with <code>pip</code>, it belongs to this virtual environment.</p><ul><li><h4 id=leave-virtual-envuronment class=anchor-link><a href=#leave-virtual-envuronment>Leave virtual envuronment<span class=pilcrow>&nbsp;Â¶</span></a></h4></li></ul><p><code>deactivate</code></p><p>This command is used to leave the virtual environment.</p><ul><li><h4 id=output-module class=anchor-link><a href=#output-module>Output module<span class=pilcrow>&nbsp;Â¶</span></a></h4></li></ul><p><code>pip freeze > requirement.txt</code></p><ul><li><h4 id=remove-the-virtual-environment class=anchor-link><a href=#remove-the-virtual-environment>Remove the virtual environment<span class=pilcrow>&nbsp;Â¶</span></a></h4></li></ul><p>Make sure you leave the virtual environment</p><p><code>rm -r temp</code></p><p>å‰©ä¸‹é€²éšçš„ç”¨æ³•å°±å»æŸ¥ <a href=https://virtualenv.pypa.io/en/stable/userguide/>document</a> å§ï¼ï¼ï¼</p><blockquote><p>macos å¯ä»¥ç”¨ <a href=https://virtualenvwrapper.readthedocs.io/en/latest/index.html>virtualenvwrapper</a> ä¾†ç®¡ç† virtualenvï¼Œå¥½ç”¨ï¼ï¼ï¼</p></blockquote><p><p style=text-align:center><img src=/blog/img/20200109/20200109-1.png alt=20200109-1></p></p><p>Source1: <a href=https://virtualenv.pypa.io/en/stable/userguide/>Virtualenv Guide</a></p><p>Source2: <a href=https://tech.r567tw.tw/python_virtualenv-%E7%B0%A1%E5%96%AE%E7%AD%86%E8%A8%98/>Python_Virtualenv ç°¡å–®ç­†è¨˜</a></p><h2 id=removing-dependencies class=anchor-link><a href=#removing-dependencies>Removing dependencies<span class=pilcrow>&nbsp;Â¶</span></a></h2><p>å°±æ˜¯æƒ³è¦æ•´ç† module ä½†æ˜¯ä¸çŸ¥é“å“ªå€‹å¯ä»¥åˆªå“ªå€‹ä¸å¯ä»¥ï¼Œæ‰€ä»¥å¾ˆéº»ç…©</p><p>åŸæœ¬æœ‰ä¸€å€‹ <code>pip-autoremove</code> çš„ module å¯ä»¥ç”¨ï¼Œä½†æ˜¯ä½œè€…å¥½åƒæ”¾æ£„æ›´æ–°äº†(abandon)</p><p>æ‰€ä»¥åœ¨ python3 æœƒæœ‰å•é¡Œï¼Œå°ï¼Œæˆ‘å°±æ˜¯ç”¨äº†ç„¶å¾Œç”¢ç”Ÿå•é¡Œ</p><p>é›–ç„¶èªªæœƒæœ‰å•é¡Œï¼Œä½†é‚„æ˜¯å¯ä»¥ç”¨é€™å€‹ä¾†å°‹æ‰¾ dependenciesï¼Œå†ä¸€å€‹ä¸€å€‹æ‰‹å‹•åˆªé™¤(è¶…ç´šéº»ç…©)</p><p><code>pip-autoremove -l &lt;module></code></p><p>ç„¶å¾ŒæŠŠåˆ—å‡ºä¾†çš„ module æ‰‹å‹•ä¸€å€‹ä¸€å€‹åˆªé™¤</p><p><p style=text-align:center><img src=/blog/img/20200109/20200109-2.png alt=20200109-2></p></p><h3 id=warning class=anchor-link><a href=#warning>Warning<span class=pilcrow>&nbsp;Â¶</span></a></h3><blockquote><p>åƒè¬ä¸è¦ç”¨ pip-autoremove å»ç§»é™¤ moduleï¼Œæƒ…æ³æœƒè®Šç•°å¸¸è¤‡é›œ</p></blockquote><p>Source: <a href=https://stackoverflow.com/questions/57470523/pip-uninstall-package-and-unique-dependencies>stackoverflow</a></p><p>Source: <a href=https://github.com/invl/pip-autoremove>pip-autoremove</a></p><h2 id=pipdeptree class=anchor-link><a href=#pipdeptree>pipdeptree<span class=pilcrow>&nbsp;Â¶</span></a></h2><p>å°±æ˜¯æŠŠ dependencies ç”¨æ¨¹ç‹€çš„æ¦‚å¿µè¡¨ç¤ºå‡ºä¾†</p><p><code>pip install pipdeptree</code></p><p>ä½¿ç”¨æ–¹æ³•å»çœ‹ <a href=https://github.com/naiquevin/pipdeptree>document</a>ï¼Œé€™è£¡ä¾†èªªå¦‚ä½•è¼¸å‡ºæˆ graph</p><p>æœ‰å››å€‹æŒ‡ä»¤å¯ä»¥ç”¨</p><pre><code>$ pipdeptree --graph-output dot &gt; dependencies.dot
$ pipdeptree --graph-output pdf &gt; dependencies.pdf
$ pipdeptree --graph-output png &gt; dependencies.png
$ pipdeptree --graph-output svg &gt; dependencies.svg
</code></pre><p>é€™å€‹è¦å®‰è£ <a href=https://graphviz.org/><code>GraphViz</code></a></p><p><code>brew install GraphViz</code></p><p><code>pip install --user GraphViz</code></p><p>å…©å€‹éƒ½è¦æ‰“ï¼ï¼ï¼</p><p>ä¸€é–‹å§‹åªæ‰“ä¸€å€‹ï¼Œå®³æˆ‘æè¶…ä¹…QQ</p><p>Source: <a href=https://github.com/naiquevin/pipdeptree>pipdeptree</a></p><h1 id=scrapy class=anchor-link><a href=#scrapy>Scrapy<span class=pilcrow>&nbsp;Â¶</span></a></h1><p>å°±æ˜¯çˆ¬èŸ²</p><h2 id=install-1 class=anchor-link><a href=#install-1>Install<span class=pilcrow>&nbsp;Â¶</span></a></h2><p><code>pip install scrapy</code></p><blockquote><p>å¼·çƒˆå»ºè­°ä½¿ç”¨ virtual environment å®‰è£</p></blockquote><h3 id=create-project class=anchor-link><a href=#create-project>Create Project<span class=pilcrow>&nbsp;Â¶</span></a></h3><p><code>scrapy startproject IUBook</code></p><p>ç„¶å¾Œåœ¨ spider è³‡æ–™å¤¾åº•ä¸‹å¯«è‡ªå·±çš„çˆ¬èŸ²</p><p><code>touch IUBook/spiders/book_spider.py</code></p><p>æ‰“ç¨‹å¼ï¼Œç…§å®˜ç¶²ä¸Š<a href=https://docs.scrapy.org/en/latest/intro/tutorial.html#our-first-spider>ç¯„ä¾‹</a>è‡ªå·±æ”¹å°±å¥½äº†</p><h3 id=cookie-and-headers class=anchor-link><a href=#cookie-and-headers>Cookie and Headers<span class=pilcrow>&nbsp;Â¶</span></a></h3><p>å…ˆè¨­å®šå¥½ cookies å’Œ headersï¼Œç­‰ request æ™‚ä¸€èµ·é€å‡ºå»</p><pre><code>cookies={'GUEST_PASSWORD': '000000'}
headers={'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11'}
</code></pre><pre><code>yield scrapy.Request(url=url, headers=headers, cookies=cookies, callback=self.parse)
</code></pre><h3 id=start class=anchor-link><a href=#start>Start<span class=pilcrow>&nbsp;Â¶</span></a></h3><p><code>scrapy crawl book</code></p><p><code>book</code> æ˜¯å› ç‚ºæˆ‘åå­—å– book</p><p><code>name= "book"</code></p><h3 id=downloading-files-linkhttpsdocsscrapyorgenlatesttopicsmedia-pipelinehtml class=anchor-link><a href=#downloading-files-linkhttpsdocsscrapyorgenlatesttopicsmedia-pipelinehtml>Downloading Files <a href=https://docs.scrapy.org/en/latest/topics/media-pipeline.html>[link]</a><span class=pilcrow>&nbsp;Â¶</span></a></h3><p>åœ¨ scrapy è£¡æ˜¯ä½¿ç”¨ <code>FilesPipeline</code> ä¾†ä¸‹è¼‰</p><ul><li><h4 id=setup class=anchor-link><a href=#setup>Setup<span class=pilcrow>&nbsp;Â¶</span></a></h4></li></ul><p>put this in <code>setting.py</code></p><p>For image:</p><pre><code>ITEM_PIPELINES = {'scrapy.pipelines.images.ImagesPipeline': 1}
IMAGES_STORE = '/path/to/valid/dir'
</code></pre><p>For files:</p><pre><code>ITEM_PIPELINES = {'scrapy.pipelines.files.FilesPipeline': 1} 
FILES_STORE = '/path/to/valid/dir'
</code></pre><p>ç„¶å¾Œå¾Œé¢æˆ‘éƒ½ä¸æœƒäº†ï¼Œè¦ç”¨åˆ° item ä½†æ˜¯çœ‹ä¸æ‡‚ï¼Œé€šé€šæŠ„ç¶²è·¯ä¸Šçš„</p><ul><li><h4 id=item class=anchor-link><a href=#item>Item<span class=pilcrow>&nbsp;Â¶</span></a></h4></li></ul><pre><code>class IUBookPic(scrapy.Item):
    title = scrapy.Field()
    file_urls = scrapy.Field()
    files = scrapy.Field() 
</code></pre><ul><li><h4 id=parse class=anchor-link><a href=#parse>Parse<span class=pilcrow>&nbsp;Â¶</span></a></h4></li></ul><pre><code>def parse(self, response):
    fileurls = response.css('span').xpath('@data-url').getall()
    yield IUBookPic(file_urls=fileurls)
</code></pre><ul><li><h4 id=robottxt class=anchor-link><a href=#robottxt>Robot.txt<span class=pilcrow>&nbsp;Â¶</span></a></h4></li></ul><p>å¯èƒ½æœƒé‡åˆ°ä¸€å€‹æƒ…æ³æ˜¯ <code>getting Forbidden by robots.txt:</code></p><p>å‰é¢çš„ user-agent ä¸€å®šè¦è¨­å®šå¥½</p><p>ç„¶å¾Œåœ¨ <code>setting.py</code> è£¡åŠ ä¸Š</p><p><code>ROBOTSTXT_OBEY=False</code></p><p>Source: <a href=https://docs.scrapy.org/en/latest/index.html>Scrapy</a></p><p>Source: <a href=https://www.pyimagesearch.com/2015/10/12/scraping-images-with-python-and-scrapy/>Scraping images with Python and Scrapy</a></p><p>Source: <a href=https://stackoverflow.com/questions/37274835/getting-forbidden-by-robots-txt-scrapy>getting Forbidden by robots.txt: scrapy</a></p><hr><p>å¥½åƒæœ‰è¦æ‰“ä»€éº¼ä¸Šä¾†ï¼Œä½†å¿˜äº†ï¼Œç­‰è¨˜å¾—äº†å†è£œå……å§</p><p>æƒ³èµ·ä¾†äº†ï¼Œä»Šå¤©æµ·å ±åˆ°äº†å•Šï¼ï¼ï¼</p><p>æˆ‘å¥½èˆˆå¥®å•Šå•Šå•Šå•Šå•Šï½ï½ï½ï¼ï¼ï¼</p><hr><p>æ‰“ä¸€ç¯‡æ–‡ç« çœŸç´¯å•Šï½ï½</p><p>è¶ç¾åœ¨é–’é–’æ²’äº‹å¤šæ‰“å¹¾ç¯‡ï¼Œå“ˆå“ˆ</p><p>çµ¦è®€åˆ°æœ€å¾Œçš„ä½ ä¸€é»é»çå‹µ</p></article></div><nav role=navigation class="flex-container bottom-menu"><hr><p><a href=/blog/posts>back</a>
&#183;
<a href=/blog/posts>POSTs</a>
&#183;
<a href=/blog/aiyu>LILAC</a>
&#183;
<a href=/blog/about>WHOAMI</a>
&#183;
<a href=/blog>main</a></p></nav></main><footer class="flex-container footer">Call me San, a theme for Hugo.</footer></body></html>