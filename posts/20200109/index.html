<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="A new Hugo site."><title>1/9 閒聊 - o1vv1rnna</title><link rel="shortcut icon" href=/blog/gura.ico><link rel=stylesheet href=/blog/css/main.min.c5514d3530979d291f3497facc20da1cec870028dbc2a3630b64bab8721bbe49.css integrity="sha256-xVFNNTCXnSkfNJf6zCDaHOyHACjbwqNjC2S6uHIbvkk=" crossorigin=anonymous media=screen><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Didact+Gothic"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kl23711579.github.io/blog/tn.png"><meta name=twitter:title content="1/9 閒聊"><meta name=twitter:description content="DebugXPythonXCrawler&nbsp;¶"><meta property="og:title" content="1/9 閒聊"><meta property="og:description" content="DebugXPythonXCrawler&nbsp;¶"><meta property="og:type" content="article"><meta property="og:url" content="https://kl23711579.github.io/blog/posts/20200109/"><meta property="og:image" content="https://kl23711579.github.io/blog/tn.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-01-10T00:24:54+10:00"><meta property="article:modified_time" content="2020-01-10T00:24:54+10:00"><meta property="og:site_name" content="o1vv1rnna"><title>1/9 閒聊</title></head><body><header class="wrap flex-container"><h1>1/9 閒聊</h1></header><main class=wrap><div class=flex-container><aside role=complementary>Fri Jan 10, 2020 &#183; 505 words<div class=tag-container><span class=tag><a href=/blog/tags/hugo/>Hugo</a></span>
<span class=tag><a href=/blog/tags/python/>Python</a></span>
<span class=tag><a href=/blog/tags/scrapy/>scrapy</a></span>
<span class=tag><a href=/blog/tags/pip/>pip</a></span></div></aside><hr><article role=article><h1 id=debugxpythonxcrawler class=anchor-link><a href=#debugxpythonxcrawler>DebugXPythonXCrawler<span class=pilcrow>&nbsp;¶</span></a></h1><p>先來首歌吧，曾經蔚藍，台灣限定 💜💙</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/TRTquokWSCw style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><h1 id=debug class=anchor-link><a href=#debug>Debug<span class=pilcrow>&nbsp;¶</span></a></h1><p>昨天差點 debug 到崩潰，完全不知道出了什麼錯誤</p><p>因為 bug 無法重現，所以之後出現再補圖吧</p><p>東翻西找，原本以為是 theme 的 layout 有問題</p><p>搞了半天結果不是 QQ</p><h2 id=bug class=anchor-link><a href=#bug>bug<span class=pilcrow>&nbsp;¶</span></a></h2><blockquote><p>Mixed content error</p></blockquote><p>最崩潰的是，開發者模式完全無法找到 bug 是怎麼發生的</p><p>出現的位置是 <code>(index):1 error</code> 也就是 <code>&lt;!DOCTYPE html></code></p><p>完全問號，不知道怎麼處理 T T</p><h2 id=solution class=anchor-link><a href=#solution>Solution<span class=pilcrow>&nbsp;¶</span></a></h2><p>後來找到的答案是把 baseURL 改掉</p><p>從 <code>baseURL= 'https://kl23711579.github.io/blog'</code> 變成 <code>baseURL= '/blog'</code></p><p>這樣就可以了</p><p>理由呢，完全不知道，真真正正的技術債啊～</p><p>Source: <a href=https://discourse.gohugo.io/t/theme-breaks-with-https-solved-by-baseurl-example-com/16427>Theme breaks with https? [SOLVED by baseURL = //example.com]</a></p><h1 id=python-and-pip class=anchor-link><a href=#python-and-pip>Python and pip<span class=pilcrow>&nbsp;¶</span></a></h1><p>今天因為要寫個爬蟲(整天有事沒事都在寫爬蟲)，想說順便要練習 python</p><p>所以選擇了 scrapy，一安裝下去就是悲劇的開始啊</p><p>因為 dependence 太多了，所以 pip 變得很難管理</p><p>再加上 pip 沒設定好，還是繼續用 python2，也要重新設定</p><p>所以花了很長一段時間重新設定 python</p><h2 id=setup-python-and-pip class=anchor-link><a href=#setup-python-and-pip>Setup python and pip<span class=pilcrow>&nbsp;¶</span></a></h2><p>首先要先確定 terminal 是用什麼 shell，我的是 zsh，所以要更改 <code>.zshrc</code> 這個檔案</p><p>加上這兩行</p><pre><code>alias python='python3'
alias pip='pip3'
</code></pre><p>In this situation, if we input <code>python</code> in terminal, it will execute <code>python3</code>.</p><p>And if we input <code>pip</code> in terminal, it will execute <code>pip3</code>.</p><p>然後 python 建議用 homebrew 管理</p><p>Source: <a href=https://opensource.com/article/19/5/python-3-default-mac>The right and wrong way to set Python 3 as default on a Mac</a></p><h2 id=virtual-environment class=anchor-link><a href=#virtual-environment>Virtual environment<span class=pilcrow>&nbsp;¶</span></a></h2><p>In order to manage the dependence of the module, I deceide to adopt <code>virtualenv</code>.</p><p>This tool can create an isolated Python environment, so you can manage dependence in this environment.</p><h3 id=install class=anchor-link><a href=#install>Install<span class=pilcrow>&nbsp;¶</span></a></h3><p><code>pip install --user virtualenv</code></p><blockquote><p>It is discourage to use <code>sudo</code> to install module.</p></blockquote><h3 id=usage class=anchor-link><a href=#usage>Usage<span class=pilcrow>&nbsp;¶</span></a></h3><ul><li><h4 id=create class=anchor-link><a href=#create>Create<span class=pilcrow>&nbsp;¶</span></a></h4></li></ul><p><code>virtualenv temp</code></p><p>It will create a directory <code>temp</code></p><ul><li><h4 id=start-virtual-envuronment class=anchor-link><a href=#start-virtual-envuronment>Start virtual envuronment<span class=pilcrow>&nbsp;¶</span></a></h4></li></ul><p><code>source temp/bin/activate</code></p><p>This will change your <code>$PATH</code> so its first entry is the virtualenv’s <code>bin/</code> directory. (You have to use source because it changes your shell environment in-place.)</p><p>Now, when you install any module with <code>pip</code>, it belongs to this virtual environment.</p><ul><li><h4 id=leave-virtual-envuronment class=anchor-link><a href=#leave-virtual-envuronment>Leave virtual envuronment<span class=pilcrow>&nbsp;¶</span></a></h4></li></ul><p><code>deactivate</code></p><p>This command is used to leave the virtual environment.</p><ul><li><h4 id=output-module class=anchor-link><a href=#output-module>Output module<span class=pilcrow>&nbsp;¶</span></a></h4></li></ul><p><code>pip freeze > requirement.txt</code></p><ul><li><h4 id=remove-the-virtual-environment class=anchor-link><a href=#remove-the-virtual-environment>Remove the virtual environment<span class=pilcrow>&nbsp;¶</span></a></h4></li></ul><p>Make sure you leave the virtual environment</p><p><code>rm -r temp</code></p><p>剩下進階的用法就去查 <a href=https://virtualenv.pypa.io/en/stable/userguide/>document</a> 吧！！！</p><blockquote><p>macos 可以用 <a href=https://virtualenvwrapper.readthedocs.io/en/latest/index.html>virtualenvwrapper</a> 來管理 virtualenv，好用！！！</p></blockquote><p><p style=text-align:center><img src=/blog/img/20200109/20200109-1.png alt=20200109-1></p></p><p>Source1: <a href=https://virtualenv.pypa.io/en/stable/userguide/>Virtualenv Guide</a></p><p>Source2: <a href=https://tech.r567tw.tw/python_virtualenv-%E7%B0%A1%E5%96%AE%E7%AD%86%E8%A8%98/>Python_Virtualenv 簡單筆記</a></p><h2 id=removing-dependencies class=anchor-link><a href=#removing-dependencies>Removing dependencies<span class=pilcrow>&nbsp;¶</span></a></h2><p>就是想要整理 module 但是不知道哪個可以刪哪個不可以，所以很麻煩</p><p>原本有一個 <code>pip-autoremove</code> 的 module 可以用，但是作者好像放棄更新了(abandon)</p><p>所以在 python3 會有問題，對，我就是用了然後產生問題</p><p>雖然說會有問題，但還是可以用這個來尋找 dependencies，再一個一個手動刪除(超級麻煩)</p><p><code>pip-autoremove -l &lt;module></code></p><p>然後把列出來的 module 手動一個一個刪除</p><p><p style=text-align:center><img src=/blog/img/20200109/20200109-2.png alt=20200109-2></p></p><h3 id=warning class=anchor-link><a href=#warning>Warning<span class=pilcrow>&nbsp;¶</span></a></h3><blockquote><p>千萬不要用 pip-autoremove 去移除 module，情況會變異常複雜</p></blockquote><p>Source: <a href=https://stackoverflow.com/questions/57470523/pip-uninstall-package-and-unique-dependencies>stackoverflow</a></p><p>Source: <a href=https://github.com/invl/pip-autoremove>pip-autoremove</a></p><h2 id=pipdeptree class=anchor-link><a href=#pipdeptree>pipdeptree<span class=pilcrow>&nbsp;¶</span></a></h2><p>就是把 dependencies 用樹狀的概念表示出來</p><p><code>pip install pipdeptree</code></p><p>使用方法去看 <a href=https://github.com/naiquevin/pipdeptree>document</a>，這裡來說如何輸出成 graph</p><p>有四個指令可以用</p><pre><code>$ pipdeptree --graph-output dot &gt; dependencies.dot
$ pipdeptree --graph-output pdf &gt; dependencies.pdf
$ pipdeptree --graph-output png &gt; dependencies.png
$ pipdeptree --graph-output svg &gt; dependencies.svg
</code></pre><p>這個要安裝 <a href=https://graphviz.org/><code>GraphViz</code></a></p><p><code>brew install GraphViz</code></p><p><code>pip install --user GraphViz</code></p><p>兩個都要打！！！</p><p>一開始只打一個，害我搞超久QQ</p><p>Source: <a href=https://github.com/naiquevin/pipdeptree>pipdeptree</a></p><h1 id=scrapy class=anchor-link><a href=#scrapy>Scrapy<span class=pilcrow>&nbsp;¶</span></a></h1><p>就是爬蟲</p><h2 id=install-1 class=anchor-link><a href=#install-1>Install<span class=pilcrow>&nbsp;¶</span></a></h2><p><code>pip install scrapy</code></p><blockquote><p>強烈建議使用 virtual environment 安裝</p></blockquote><h3 id=create-project class=anchor-link><a href=#create-project>Create Project<span class=pilcrow>&nbsp;¶</span></a></h3><p><code>scrapy startproject IUBook</code></p><p>然後在 spider 資料夾底下寫自己的爬蟲</p><p><code>touch IUBook/spiders/book_spider.py</code></p><p>打程式，照官網上<a href=https://docs.scrapy.org/en/latest/intro/tutorial.html#our-first-spider>範例</a>自己改就好了</p><h3 id=cookie-and-headers class=anchor-link><a href=#cookie-and-headers>Cookie and Headers<span class=pilcrow>&nbsp;¶</span></a></h3><p>先設定好 cookies 和 headers，等 request 時一起送出去</p><pre><code>cookies={'GUEST_PASSWORD': '000000'}
headers={'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11'}
</code></pre><pre><code>yield scrapy.Request(url=url, headers=headers, cookies=cookies, callback=self.parse)
</code></pre><h3 id=start class=anchor-link><a href=#start>Start<span class=pilcrow>&nbsp;¶</span></a></h3><p><code>scrapy crawl book</code></p><p><code>book</code> 是因為我名字取 book</p><p><code>name= "book"</code></p><h3 id=downloading-files-linkhttpsdocsscrapyorgenlatesttopicsmedia-pipelinehtml class=anchor-link><a href=#downloading-files-linkhttpsdocsscrapyorgenlatesttopicsmedia-pipelinehtml>Downloading Files <a href=https://docs.scrapy.org/en/latest/topics/media-pipeline.html>[link]</a><span class=pilcrow>&nbsp;¶</span></a></h3><p>在 scrapy 裡是使用 <code>FilesPipeline</code> 來下載</p><ul><li><h4 id=setup class=anchor-link><a href=#setup>Setup<span class=pilcrow>&nbsp;¶</span></a></h4></li></ul><p>put this in <code>setting.py</code></p><p>For image:</p><pre><code>ITEM_PIPELINES = {'scrapy.pipelines.images.ImagesPipeline': 1}
IMAGES_STORE = '/path/to/valid/dir'
</code></pre><p>For files:</p><pre><code>ITEM_PIPELINES = {'scrapy.pipelines.files.FilesPipeline': 1} 
FILES_STORE = '/path/to/valid/dir'
</code></pre><p>然後後面我都不會了，要用到 item 但是看不懂，通通抄網路上的</p><ul><li><h4 id=item class=anchor-link><a href=#item>Item<span class=pilcrow>&nbsp;¶</span></a></h4></li></ul><pre><code>class IUBookPic(scrapy.Item):
    title = scrapy.Field()
    file_urls = scrapy.Field()
    files = scrapy.Field() 
</code></pre><ul><li><h4 id=parse class=anchor-link><a href=#parse>Parse<span class=pilcrow>&nbsp;¶</span></a></h4></li></ul><pre><code>def parse(self, response):
    fileurls = response.css('span').xpath('@data-url').getall()
    yield IUBookPic(file_urls=fileurls)
</code></pre><ul><li><h4 id=robottxt class=anchor-link><a href=#robottxt>Robot.txt<span class=pilcrow>&nbsp;¶</span></a></h4></li></ul><p>可能會遇到一個情況是 <code>getting Forbidden by robots.txt:</code></p><p>前面的 user-agent 一定要設定好</p><p>然後在 <code>setting.py</code> 裡加上</p><p><code>ROBOTSTXT_OBEY=False</code></p><p>Source: <a href=https://docs.scrapy.org/en/latest/index.html>Scrapy</a></p><p>Source: <a href=https://www.pyimagesearch.com/2015/10/12/scraping-images-with-python-and-scrapy/>Scraping images with Python and Scrapy</a></p><p>Source: <a href=https://stackoverflow.com/questions/37274835/getting-forbidden-by-robots-txt-scrapy>getting Forbidden by robots.txt: scrapy</a></p><hr><p>好像有要打什麼上來，但忘了，等記得了再補充吧</p><p>想起來了，今天海報到了啊！！！</p><p>我好興奮啊啊啊啊啊～～～！！！</p><hr><p>打一篇文章真累啊～～</p><p>趁現在閒閒沒事多打幾篇，哈哈</p><p>給讀到最後的你一點點獎勵</p></article></div><nav role=navigation class="flex-container bottom-menu"><hr><p><a href=/blog/posts>back</a>
&#183;
<a href=/blog/posts>POSTs</a>
&#183;
<a href=/blog/aiyu>LILAC</a>
&#183;
<a href=/blog/about>WHOAMI</a>
&#183;
<a href=/blog>main</a></p></nav></main><footer class="flex-container footer">Call me San, a theme for Hugo.</footer></body></html>